@page "/puzzle"
@rendermode @(new InteractiveWebAssemblyRenderMode(false))
@using GameConfig
@inherits PuzzlePresenter


<PageTitle>SlideQuest</PageTitle>

<div class="slide-quest-puzzle">
    @if (Grid is not null)
    {
        <div class="legend">
            <span class="cell start"></span> Départ
            <span class="cell end"></span> Arrivée
            <span class="cell path"></span> Chemin garanti
            <span class="cell obstacle"></span> Obstacle
            <span class="cell empty"></span> Glace (vide)
            <span class="cell player"></span> Joueur
        </div>

        <div class="play-controls">
            <button class="btn" @onclick='@(() => SlideButton("U"))'>↑</button>
            <div>
                <button class="btn" @onclick='@(() => SlideButton("L"))'>←</button>
                <button class="btn" @onclick='@(() => SlideButton("D"))'>↓</button>
                <button class="btn" @onclick='@(() => SlideButton("R"))'>→</button>
            </div>
            <small>Clavier: flèches / WASD / ZQSD</small>
        </div>

        <div class="grid-container" style="--size: 480px; --n: @Grid?.Width; --m: @Grid?.Height;">
            <div class="grid">
                @for (int y = 0; y < Grid?.Height; y++)
                {
                    @for (int x = 0; x < Grid?.Width; x++)
                    {
                        string cls = Grid.Cells[x, y].Type switch
                        {
                            CellType.Start => "start",
                            CellType.End => "end",
                            CellType.Path => "path",
                            CellType.Obstacle => "obstacle",
                            _ => "empty"
                        };
                        bool isPlayer = (PlayerCell.X == x && PlayerCell.Y == y);
                        <div class="cell @cls @(isPlayer ? "player" : string.Empty)" title="(@x,@y)"></div>
                    }
                }
            </div>
        </div>

        <div class="moves" hidden="@(Grid.MovesForWin.Count == 0)">
            <h4>Suite de mouvements (flèches) pour résoudre:</h4>
            <p>
                @foreach (var m in Grid.MovesForWin)
                {
                    @:(@(m switch { SlideQuest.Shared.Enums.Direction.Top => "⬆️", SlideQuest.Shared.Enums.Direction.Bottom => "⬇️", SlideQuest.Shared.Enums.Direction.Left => "⬅️", SlideQuest.Shared.Enums.Direction.Right => "➡️", _ => "" })) 
                }
            </p>
            <p><small>Seed utilisée: @Grid.Seed</small></p>
        </div>

        <GameLogger @ref="Logger" />
    }
    else
    {
        <div class="slide-quest-gen-rules">
            <h3 class="slide-quest-gen-rules__title">Pour créer une partie, tapez la commande :</h3>

            <ul class="slide-quest-gen-rules-commands">
                <li><span>!gen</span>   →   génère une map en difficulté @Difficulty.Normal</li>
                <li><span>!gen 1</span>   →   génère une map en difficulté @Difficulty.Easy</li>
                <li><span>!gen 2</span>   →   génère une map en difficulté @Difficulty.Normal</li>
                <li><span>!gen 3</span>   →   génère une map en difficulté @Difficulty.Hard</li>
                <li><span>!gen 4</span>   →   génère une map en difficulté @Difficulty.Expert</li>

                <li><span>!genseed 12345</span>   →   génère une map en difficulté @Difficulty.Normal avec une seed</li>
                <li><span>!genseed 1 12345</span>   →   génère une map en difficulté @Difficulty.Easy avec une seed</li>
                <li><span>!genseed 2 12345</span>   →   génère une map en difficulté @Difficulty.Normal avec une seed</li>
                <li><span>!genseed 3 12345</span>   →   génère une map en difficulté @Difficulty.Hard avec une seed</li>
                <li><span>!genseed 4 12345</span>   →   génère une map en difficulté @Difficulty.Expert avec une seed</li>
            </ul>
        </div>
    }
</div>
